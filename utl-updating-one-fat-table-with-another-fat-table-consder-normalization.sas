Updating one fat table with another fat table consder normalization                                                                          
                                                                                                                                             
github                                                                                                                                       
https://tinyurl.com/y5gepm9m                                                                                                                 
https://github.com/rogerjdeangelis/utl-updating-one-fat-table-with-another-fat-table-consder-normalization                                   
                                                                                                                                             
SAS Forum                                                                                                                                    
https://tinyurl.com/yycjkd3d                                                                                                                 
https://communities.sas.com/t5/SAS-Programming/Overwriting-incorrect-values/m-p/540573                                                       
                                                                                                                                             
*_                   _                                                                                                                       
(_)_ __  _ __  _   _| |_                                                                                                                     
| | '_ \| '_ \| | | | __|                                                                                                                    
| | | | | |_) | |_| | |_                                                                                                                     
|_|_| |_| .__/ \__,_|\__|                                                                                                                    
        |_|                                                                                                                                  
;                                                                                                                                            
                                                                                                                                             
data master;                                                                                                                                 
   retain pr_id;                                                                                                                             
   array dat[6] $16  Reportability_Indicator Complaint_Code Clinical_Harm Product_Family Model_Number Hospital_Country (6*'********');       
                                                                                                                                             
   input pr_id @@;                                                                                                                           
cards4;                                                                                                                                      
1001 2000 3000 4556 4557 4584 4585 4611 5000 9212 10000 11001 11028                                                                          
12014 12289 13000 18315 19000 19008 19149 19328 19649 19800 20000                                                                            
20229 30000                                                                                                                                  
;;;;                                                                                                                                         
run;quit;                                                                                                                                    
                                                                                                                                             
MASTER table that needs updating                                                                                                             
--------------------------------                                                                                                             
                                                                                                                                             
WORK.MASTER total obs=26                                                                                                                     
                                                                                                                                             
          REPORTABILITY_    COMPLAINT_    CLINICAL_    PRODUCT_     MODEL_     HOSPITAL_                                                     
 PR_ID      INDICATOR          CODE         HARM        FAMILY      NUMBER      COUNTRY                                                      
                                                                                                                                             
  1001       ********        ********     ********     ********    ********    ********                                                      
  2000       ********        ********     ********     ********    ********    ********                                                      
  3000       ********        ********     ********     ********    ********    ********                                                      
  4556       ********        ********     ********     ********    ********    ********                                                      
  4557       ********        ********     ********     ********    ********    ********                                                      
  4584       ********        ********     ********     ********    ********    ********                                                      
  4585       ********        ********     ********     ********    ********    ********                                                      
  4611       ********        ********     ********     ********    ********    ********                                                      
  5000       ********        ********     ********     ********    ********    ********                                                      
  9212       ********        ********     ********     ********    ********    ********                                                      
 10000       ********        ********     ********     ********    ********    ********                                                      
 11001       ********        ********     ********     ********    ********    ********                                                      
 11028       ********        ********     ********     ********    ********    ********                                                      
 12014       ********        ********     ********     ********    ********    ********                                                      
 12289       ********        ********     ********     ********    ********    ********                                                      
 13000       ********        ********     ********     ********    ********    ********                                                      
 18315       ********        ********     ********     ********    ********    ********                                                      
 19000       ********        ********     ********     ********    ********    ********                                                      
 19008       ********        ********     ********     ********    ********    ********                                                      
 19149       ********        ********     ********     ********    ********    ********                                                      
 19328       ********        ********     ********     ********    ********    ********                                                      
 19649       ********        ********     ********     ********    ********    ********                                                      
 19800       ********        ********     ********     ********    ********    ********                                                      
 20000       ********        ********     ********     ********    ********    ********                                                      
 20229       ********        ********     ********     ********    ********    ********                                                      
 30000       ********        ********     ********     ********    ********    ********                                                      
                                                                                                                                             
                                                                                                                                             
data trans;                                                                                                                                  
 input PR_ID (Reportability_Indicator Complaint_Code Clinical_Harm Product_Family Model_Number Hospital_Country) (: $16.);                   
cards4;                                                                                                                                      
1001 . . . . . Italy                                                                                                                         
4556 . . . . . UnitedKingdom                                                                                                                 
4557 . . . . . .                                                                                                                             
4584 . . . . . .                                                                                                                             
4585 . . . . . Germany                                                                                                                       
4611 . . . . . .                                                                                                                             
9212 Yes . . . . .                                                                                                                           
11001 Yes . . . . .                                                                                                                          
11028 Yes . . . . .                                                                                                                          
12014 Yes . . . . .                                                                                                                          
12289 . . . ABCD . .                                                                                                                         
18315 Yes . . . . .                                                                                                                          
19008 Yes . . . . .                                                                                                                          
19149 . . . . . France                                                                                                                       
19328 Yes . . . . .                                                                                                                          
19649 . . . XYZ . .                                                                                                                          
19800 Yes . . . . .                                                                                                                          
20229 . . . . PN-12345 .                                                                                                                     
;;;;                                                                                                                                         
run;quit;                                                                                                                                    
                                                                                                                                             
TRANSACTION TABLE                                                                                                                            
-----------------                                                                                                                            
                                                                                                                                             
Up to 40 obs WORK.TRANS total obs=18                                                                                                         
                                                                                                                                             
                REPORTABILITY_    COMPLAINT_    CLINICAL_    PRODUCT_     MODEL_     HOSPITAL_                                               
Obs    PR_ID      INDICATOR          CODE         HARM        FAMILY      NUMBER     COUNTRY                                                 
                                                                                                                                             
  1     1001                                                                         Italy                                                   
  2     4556                                                                         UnitedKingdom                                           
  3     4557                                                                                                                                 
  4     4584                                                                                                                                 
  5     4585                                                                         Germany                                                 
  6     4611                                                                                                                                 
  7     9212         Yes                                                                                                                     
  8    11001         Yes                                                                                                                     
  9    11028         Yes                                                                                                                     
 10    12014         Yes                                                                                                                     
 11    12289                                                   ABCD                                                                          
 12    18315         Yes                                                                                                                     
 13    19008         Yes                                                                                                                     
 14    19149                                                                         France                                                  
 15    19328         Yes                                                                                                                     
 16    19649                                                   XYZ                                                                           
 17    19800         Yes                                                                                                                     
 18    20229                                                             PN-12345                                                            
                                                                                                                                             
*            _               _                                                                                                               
  ___  _   _| |_ _ __  _   _| |_                                                                                                             
 / _ \| | | | __| '_ \| | | | __|                                                                                                            
| (_) | |_| | |_| |_) | |_| | |_                                                                                                             
 \___/ \__,_|\__| .__/ \__,_|\__|                                                                                                            
                |_|                                                                                                                          
;                                                                                                                                            
                                                                                                                                             
Up to 40 obs from WANT total obs=26                                                                                                          
                                                                                                                                             
                REPORTABILITY_    COMPLAINT_    CLINICAL_    PRODUCT_     MODEL_     HOSPITAL_                                               
Obs    PR_ID      INDICATOR          CODE         HARM        FAMILY      NUMBER     COUNTRY                                                 
                                                                                                                                             
  1     1001       ********        ********     ********     ********    ********    Italy                                                   
  2     2000       ********        ********     ********     ********    ********    ********                                                
  3     3000       ********        ********     ********     ********    ********    ********                                                
  4     4556       ********        ********     ********     ********    ********    UnitedKingdom                                           
  5     4557       ********        ********     ********     ********    ********    ********                                                
  6     4584       ********        ********     ********     ********    ********    ********                                                
  7     4585       ********        ********     ********     ********    ********    Germany                                                 
  8     4611       ********        ********     ********     ********    ********    ********                                                
  9     5000       ********        ********     ********     ********    ********    ********                                                
 10     9212       Yes             ********     ********     ********    ********    ********                                                
 11    10000       ********        ********     ********     ********    ********    ********                                                
 12    11001       Yes             ********     ********     ********    ********    ********                                                
 13    11028       Yes             ********     ********     ********    ********    ********                                                
 14    12014       Yes             ********     ********     ********    ********    ********                                                
 15    12289       ********        ********     ********     ABCD        ********    ********                                                
 16    13000       ********        ********     ********     ********    ********    ********                                                
 17    18315       Yes             ********     ********     ********    ********    ********                                                
 18    19000       ********        ********     ********     ********    ********    ********                                                
 19    19008       Yes             ********     ********     ********    ********    ********                                                
 20    19149       ********        ********     ********     ********    ********    France                                                  
 21    19328       Yes             ********     ********     ********    ********    ********                                                
 22    19649       ********        ********     ********     XYZ         ********    ********                                                
 23    19800       Yes             ********     ********     ********    ********    ********                                                
 24    20000       ********        ********     ********     ********    ********    ********                                                
 25    20229       ********        ********     ********     ********    PN-12345    ********                                                
 26    30000       ********        ********     ********     ********    ********    ********                                                
                                                                                                                                             
*          _       _   _                                                                                                                     
 ___  ___ | |_   _| |_(_) ___  _ __                                                                                                          
/ __|/ _ \| | | | | __| |/ _ \| '_ \                                                                                                         
\__ \ (_) | | |_| | |_| | (_) | | | |                                                                                                        
|___/\___/|_|\__,_|\__|_|\___/|_| |_|                                                                                                        
                                                                                                                                             
;                                                                                                                                            
                                                                                                                                             
                                                                                                                                             
proc sql;                                                                                                                                    
  create                                                                                                                                     
     table want as                                                                                                                           
  select                                                                                                                                     
      r.pr_id                                                                                                                                
     ,coalesce(l.Reportability_Indicator,r.Reportability_Indicator) as Reportability_Indicator                                               
     ,coalesce(l.Complaint_Code,r.Complaint_Code) as Complaint_Code                                                                          
     ,coalesce(l.Clinical_Harm,r.Clinical_Harm) as Clinical_Harm                                                                             
     ,coalesce(l.Product_Family,r.Product_Family) as Product_Family                                                                          
     ,coalesce(l.Model_Number,r.Model_Number) as Model_Number                                                                                
     ,coalesce(l.Hospital_Country,r.Hospital_Country) as Hospital_Country                                                                    
  from                                                                                                                                       
     trans as l right join master as r                                                                                                       
  on                                                                                                                                         
     l.pr_id= r.pr_id                                                                                                                        
;quit;                                                                                                                                       
                                                                                                                                             
                                                                                                                                             
                                                                                                                                             
